# Machine Learning Term Project

## 1. **Introduction**

본 프로젝트는 다양한 재료를 조합해 주문하는 샌드위치 체인점을 대상으로, 고객의 선호도 기반 맞춤형 샌드위치 조합 추천 시스템을 구축하는 것을 목표로 한다. 개인화된 추천 기능을 통해 고객 경험 및 만족도를 향상시키는 동시에, 재료 소비 패턴을 예측하여 신선도 관리 및 재고 관리 효율화 역시 도모하고자 한다.

### **1.1 문제 정의**

현재 대부분의 샌드위치 체인점은 사용자 취향을 반영한 **개인화 재료 조합 추천 시스템이 부재**하여 고객의 선택 피로도가 증가하고, 체계적인 재료 수요 예측이 어렵다는 문제가 발생한다.

### **1.2 프로젝트 목표**

1. 사용자별 재료 선호도를 분석해 개인화된 샌드위치 조합 추천 제공
2. 건강정보, 성별, 나이대 등 사용자 특성 정보를 활용한 맞춤 추천 기능 설계
3. 프로젝트를 위한 데이터셋 제작 → 통계적 관계 분석 → 모델의 수학적 원리 이해 및 적용

### **1.3 워크플로우**

이상적인 데이터 제작 후 훈련용 데이터셋 분리 → 모델링 (훈련용 데이터셋) → 평가 (이상적인 테스트용 데이터셋) → 결론 도출

---

## 2. **Data Description**

본 프로젝트는 목표에 적합한 공개 데이터셋이 없어, 직접 데이터를 제작하여 추천 시스템을 개발하였다. 생성된 데이터셋은 총 4종류로 구성된다.

### 2.1 사용자 데이터셋 (**user_info.csv)**

- 1000명의 사용자 정보 (1000×5)
- 성별, 연령대, 식습관, 채식 여부, 알레르기 정보를 포함

| **user_id** | **gender** | **age_group** | **diet** | **vegetarian** | **allergy** |
| --- | --- | --- | --- | --- | --- |
| user_001 | 0 | 0 | False | False | [] |
| user_002 | 1 | 0 | False | False | [] |
| user_003 | 1 | 3 | True | False | [] |
| user_004 | 1 | 0 | True | True | ['Meat_5', 'Vegtable_3'] |

### 2.2 샌드위치 재료 데이터셋 (**ingredient_nutrition.csv)**

- 20개의 재료 (4개 카테고리 × 5개 세부 재료)
- 재료별 칼로리 정보 포함
- 빵(Bread), 채소(Vegetable), 고기(Meat), 소스(Source)

| **Category** | **Ingredient** | **Calories** |
| --- | --- | --- |
| Bread_1 | 화이트 | 195.0 |
| … |  |  |
| Vegtable_1 | 양상추 | 2.9 |
| … |  |  |
| Meat_1 | 콩고기 | 150.0 |
| … |  |  |
| Source_1 | 스위트 어니언 | 40.1 |

### 2.3 샌드위치 조합 데이터셋 (combo.csv)

- 625개의 조합 (4개 카테고리에서 각 1개의 재료 선택)
- 원-핫 인코딩 적용 (625×20)

| **combo_id** | **Bread_1** | … | **Vegtable_1** | … | **Meat_5** | … | **Source_5** |
| --- | --- | --- | --- | --- | --- | --- | --- |
| C001 | 1 |  | 1 |  | 0 |  | 0 |
| C002 | 1 |  | 1 |  | 0 |  | 0 |
| C003 | 1 |  | 1 |  | 0 |  | 1 |
| C004 | 1 |  | 1 |  | 0 |  | 0 |

### 2.4 유저 평점 데이터셋 (**rating_dataset.csv)**

- 1000명 × 625조합 (희소행렬)
- 각 유저당 약 180개 조합에 대한 평점 존재, 나머지는 결측값

| user_id | C001 | … | C625 |
| --- | --- | --- | --- |
| user_001 | 3.36 |  | N/A |
| user_002 | N/A |  | 4.24 |
| user_003 | 2.38 |  | 4.6 |
| user_004 | 3.93 |  | 3.76 |

### 2.5 데이터 생성 플로우

1. 사용자별 20개의 재료에 대한 기본 선호도 생성 (랜덤, 0~5점, 0.5점 단위)
2. 재료별 다양성을 반영한 선호도 조정
    - 빵: 점수 편차 작음, 고기: 점수 편차 큼
3. 사용자 특성 반영: 채식 여부, 알레르기 정보 적용
4. 성별 및 연령대별 선호도 편차 적용
5. 20개 재료 선호도 × 4개 카테고리 비중 → 샌드위치 조합 평점 계산
6. 전체 평점 데이터셋 (1000명 × 625조합) 생성 → 테스트 데이터

### 2.6 모델 훈련 및 테스트 데이터셋 분리

- 인기 조합 기준 분류:
    - Top 100 조합
    - Second 200 조합
- Top 100 중 유저가 경험한 80개 샌드위치 평점 선택
- Second 200 중 유저가 경험한 100개 샌드위치 평점 선택
- 최종 트레인 데이터셋: 각 유저 180개 조합 평점 (현실적인 데이터셋 생성)

---

## 3. **Problem Definition & Strategy**

### 3.1 User-Based Collaborative Filtering

- 사용자의 평점 행렬에서 유사한 취향을 가진 다른 사용자를 찾아, 그들이 높게 평가한 아이템을 추천
- 유사도는 Pearson 상관계수로 계산하며, mean-centering으로 개인 편향을 보정

### 3.2 Item-Based Collaborative Filtering

- 아이템 간 평점 패턴의 유사도를 기반으로, 사용자가 과거에 좋아했던 아이템과 유사한 아이템을 추천
- Adjusted Cosine 유사도로 사용자 평균 평점을 보정하고, 상위 k개의 유사 아이템만 활용

### 3.3 Matrix Factorization (ALS)

- 사용자와 아이템을 latent factor 벡터로 표현하여 평점 행렬을 저차원으로 근사
- ALS(Alternating Least Squares) 알고리즘을 이용해 사용자 벡터와 아이템 벡터를 번갈아 학습, 전체 평균 평점을 기준으로 예측

### 3.4 하이브리드 추천 (User + Item + MF)

- UBCF, IBCF, MF 세 모델의 예측 점수를 **정규화 후 가중합**하여 최종 추천 점수를 생성합니다.
- 각 모델의 장점을 결합하여 정확도를 높이고, 제약 조건과 칼로리 우선순위 고려

---

## 4. **System Design**

### **4.1 Data Pipeline**

- CSV 로드
- 인덱스 설정 (`user_id`, `combo_id`)
- 기본 통계 계산 (`user_mean`, `item_mean`)

### **4.2 Preprocessing Module**

- **칼로리 계산 :** 각 조합별 칼로리 계산 (`combo_calories = df_combo.dot(cal_map)`)
- **채식/소이 필터링 :** 콩고기(SOY_ID) 감지, 단독 조합(SOY_ONLY_IDS) 선정
- **평점 행렬 재정렬 :** 모든 `combo_id` 기준 열 구성
- **제약 조건 처리 함수 :** 알레르기 필터링, 채식 필터링, 후보 조합 마스크 생성

### **4.3 Model Training Pipeline**

- Step 1: User-Based CF
    - Pearson 유사도 기반, Top-k 유사 사용자 선택
    - Mean-centering 예측 → `df_pred_user`
- Step 2: Item-Based CF
    - Adjusted Cosine 유사도 기반, Top-k 유사 아이템 선택
    - Weighted sum 예측 → `df_pred_item`
- Step 3: Matrix Factorization (ALS)
    - 사용자/아이템 잠재 요인(P, Q) 학습, ALS 반복 학습
    - 전체 평균 평점 기준 예측 → MF 모델 (`mf_model`)
- Step 4: 하이브리드 추천
    - UBCF + IBCF + MF 점수 정규화 후 가중합
    - 최종 점수 행렬 → `df_pred_hybrid`

### **4.4 추천 & 후처리**

- 후보 아이템 선정: 미평가 + 알레르기/채식 필터 적용
- Diet flag 고려: 점수 + 칼로리 가중합 또는 lexicographic 정렬
- 최종 상위 k 추천 산출 (예: 5개)
- Pretty print: 조합 ID, 점수, 칼로리, 재료 목록 표시

---

## 5. **Model Development**

---

## 6. **Experiments & Evaluation**

---

## 7. **Result Analysis**

---

## 8. **Limitations & Future Work**

### **8.1 데이터 관련 한계**

**8.1.1 생성 데이터 기반 / 데이터 현실성 부족**

- 유저, 조합, 평점, 영양 데이터 모두 시뮬레이션 또는 임의 생성
- 실제 사용자 행동, 선호 패턴, 알레르기/채식 정보 등 현실과 다름
- 평점 행렬, 조합 구성, 콩고 단독 조합 등 현실 데이터와 차이 큼

**8.1.2 재료 간 상호작용 무시**

- 모든 계산이 선형 + 단순 유사도 → 현실적 추천 품질 판단 불가
- 재료 간 맛, 조화, 조리 방식 등 비선형적 상호작용 반영 불가

### **8.2 모델 기반 한계**

**8.2.1 User-Based / Item-Based CF**

- 평점이 생성 데이터라서 실제 유저 유사도를 정확히 반영 불가
- Pearson / Adjusted Cosine도 실제 패턴 없는 데이터에서는 의미 제한

**8.2.2 Matrix Factorization**

- 단순 $μ + P·Q$ 형태 : 생성 데이터에서 오버핏 위험성

**8.2.3 세 모델(UBCF, IBCF, MF) 점수 단순 합산**

- 선형 가중합 : 실제 재료 선호, 조합 선호, 맛/영양 상관관계 반영 불가

**8.2.4 정규화(min-max) 및 가중치 합산** 

- 생성 데이터 특성에 의존적, 현실성 반영 제한

### **8.3 성능 및 확장성 한계**

- 생성 데이터 기반이라 현실 데이터 미반영
- 모든 계산이 선형 + 단순 유사도 → 현실적 추천 품질 판단 불가
- 실시간 추천, cold-start 문제 등은 실제 데이터에서 검증 필요

### 8.4 향후 과제

**8.4.1 실제 데이터 적용**

- 현재 시스템은 **단순 선형 관계를 가정한 시뮬레이션 데이터**로 테스트
- 실제 사용자 평점, 구매 로그, 영양/알레르기 데이터 등 **현실 데이터를 수집**하여 모델 정확도 검증

**8.4.2 비선형 관계 및 복잡한 상호작용 반영**

- 현재 시스템은 선형 가중합 기반으로 동작, 복잡한 사용자-아이템 상호작용 반영 불가능
- 딥러닝 기반 추천 모델 등 비선형 모델 적용

**8.4.3 개인화 및 상황별 추천 강화**

- 현재는 채식, 알레르기 등 제약 조건만 일부 반영
- 실시간 행동 데이터, 컨텍스트를 반영한 개인화 추천 확장 필요

**8.4.4 하이브리드 모델 확장**

- 기존 가중합 방식 외에, **비선형 가중치 학습, 앙상블 학습** 등을 통해 추천 정확도 향상

---

## 9. **Conclusion**

- 프로젝트 요약
- 주요 성과
- 배운 점 및 서비스 적용 가능성
- 실질적인 비즈니스 가치

---

## 11. **Appendix**

### 11.1 팀원 역할

| 송영우 202135546 | 아이디어 제안, 데이터셋 제적 |
| --- | --- |
| 현관 202135596 | 추천 시스템 모델링 |
| 황성민 202135599 | 모델링 테스트 및 평가 |
| 오예진 202234908 | 최종 정리 및 발표 |

### 11.2 프로젝트 일정

| 9 Week | 아이디어 선정, proposal 작성 |
| --- | --- |
| 10 Week | 데이터셋 제작, 추천 시스템 초기 구축 |
| 11 Week | 추천 모델링 구축, 모델 테스트 및 평가 |
| 12 Week | 프로젝트 최종 보고서 작성, 발표 |

### 11.3 Git 주소

[https://github.com/Machine-Learning-team10](https://github.com/Machine-Learning-team10)